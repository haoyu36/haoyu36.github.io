<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>python面向对象 | haoyu blog</title><meta name=keywords content="python"><meta name=description content="面向对象 本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 06-面向对象
[TOC]
面向对象 In python everything is an object."><meta name=author content><link rel=canonical href=http://120.79.76.172:8381/post/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="python面向对象"><meta property="og:description" content="面向对象 本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 06-面向对象
[TOC]
面向对象 In python everything is an object."><meta property="og:type" content="article"><meta property="og:url" content="http://120.79.76.172:8381/post/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-10-01T15:40:18+00:00"><meta property="article:modified_time" content="2021-10-01T15:40:18+00:00"><meta property="og:site_name" content="haoyu blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="python面向对象"><meta name=twitter:description content="面向对象 本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 06-面向对象
[TOC]
面向对象 In python everything is an object."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://120.79.76.172:8381/post/"},{"@type":"ListItem","position":3,"name":"python面向对象","item":"http://120.79.76.172:8381/post/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"python面向对象","name":"python面向对象","description":"面向对象 本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 06-面向对象\n[TOC]\n面向对象 In python everything is an object.","keywords":["python"],"articleBody":"面向对象 本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 06-面向对象\n[TOC]\n面向对象 In python everything is an object. objects are first class citizens\n面向对象 对象：\n对象是一个数据以及相关行为的集合，对象是一个模型，模型可以做特定的事情并且特定的事情可以作用在它们身上 python 对象是存储在内存中的实体，通常是一段具有特定格式的内存。每个对象都有两个标准的头部信息，类型标识符和引用计数器 面向对象\n通过数据和行为来描述和与对象交互 数据：代表一个给定对象的个体特征 行为：发生再对象身上的动作 有三个基本特征：封装，继承，多态 Python 既支持面向对象编程也支持函数式编程。在 Python 中，所有事物都是 object，包括数值、列表、函数、None、模块等等\n类与对象 Class is a blueprint or template from which objects are created. 类描述了对象，是创建对象的模版\n类 (Class)定义了事物的抽象特点，有共有的属性和方法。类就是一个模板，模板里可以包含多个函数，函数里实现一些功能。类本质仍然是一个对象，可以赋值给变量，可拷贝，可作为函数参数传递\n对象 是类的实例 (Instance)。类可生成多个实例，可被继承和扩展，支持运算符，可按需重载\n当 Python 遇到关键字 class 时，就在内存中开辟一块空间，类中的方法也存储在开辟的空间内。当以这个类创建实例时，就在内存中开辟另一块空间，通过类对象指针指向类的空间\n1 2 3 4 5 6 7 8 9 In: class Foo: pass In: f = Foo() # 创建 Foo 的实例 In: print(Foo) \u003cclass '__main__.Foo'\u003e In: print(f) \u003c__main__.Foo object at 0x109db6fd0\u003e 一等对象 所有可以在语言中命名的对象都具有同等的状态。都作为一等对象 (First Class Citizens) 存在。一等对象有以下特点：\n在运行时创建 能赋值给变量或数据结构中的元素 能作为参数传给函数 能作为函数的返回结果 对象成员 属性 属性 (attribute)：对象可以使用属于它的变量来存储数据，这种从属于对象或类的变量就是属性，它描述了对象的特征\n实例变量：保存在实例中，不同实例之间不影响，只能通过实例访问 类变量：保存在类中，多有实例共享，可以通过实例访问，也可以通过类访问。当需要在一个类的不同实例之间共享变量的时可以用类变量 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 In : class Foo: ...: a = 123 ...: b = [] In : f1, f2 = Foo(), Foo() In : f1.a, f2.a, Foo.a Out: (123, 123, 123) In : f1.a = 1 In : f1.a, f2.a, Foo.a Out: (1, 123, 123) In : Foo.a = 4 In : f1.a, f2.a, Foo.a Out: (1, 4, 4) In : f1.b.append(1) In : f1.b, f2.b, Foo.b Out: ([1], [1], [1]) In : Foo.__dict__ # 类型的名字空间返回只读视图，不允许修改 Out: mappingproxy({'__module__': '__main__', 'a': 123, 'b': [1], ...}) In : f1.__dict__ # 实例的名字空间是普通字典，可修改 Out: {} 方法 方法(method)：类中的函数，能通过它对对象做操作\n实例方法由实例调用，自动把调用该方法的实例赋值给 self 静态方法由类或实例调用，无默认参数，使用 @staticmethod 装饰器实现 类方法由类或实例调用，第一个参数是类本身，约定 cls，使用 @classmethod 装饰器实现 静态方法和类方法都访问不到实例变量，因为没有 self。实例方法影响的只是实例的变量，影响不到类变量，而类方法当作实例方法会影响实例变量和类变量\n1 2 3 4 5 6 7 8 9 10 11 class Foo(object): def instance_method(self): print('我是实例方法') @staticmethod def static_method(): print('我是静态方法') @classmethod def class_method(cls): print('我是类方法') 私有字段 __xxx__: Python 语言定义的特殊方法，用来区别其他用户自定义的命名，如 __init__() _xxx: 用来指定变量私有，用做提示，对程序没有任何影响 __xxx: 在类中会触发名称改写，只能通过 对象名._类名__xxx 的方式访问 xxx_: 用以避免与 Python 关键字冲突 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 class Foo(): _xxx = 123 def __init__(self, name): self.__xx = name In: f = Foo('haoyu') In: f._xxx Ou: 123 In : f.__xx AttributeError: 'Foo' object has no attribute '__xx' In : f._Foo__xx Out: 'haoyu' In : f.__dict__ Out: {'_Foo__xx': 'haoyu'} property @property 装饰器就是负责把一个方法变成属性调用，方法内部进行一系列的逻辑计算，最终返回结果。定义时，在普通方法的基础上添加 @property 装饰器，属性仅有一个 self 参数，调用时，无需括号\n可以通过设置 get 方法而不定义 set 方法就可以实现变量的只读属性\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class Foo: @property def attr(self): return 123 @attr.setter def attr(self, val): print(val) @attr.deleter def attr(self): print(666) In : f = Foo() In : f.attr Out: 123 In : f.attr = 456 456 In : del f.attr 666 三大特征 继承 继承：\n子类可以继承父类通用类型的属性和方法。也就是在父类或者说基类里面实现一次就能被子类重用 对于面向对象的继承来说，其实就是将多个类共有的方法提取到父类中，子类仅需继承父类而不必一一实现每个方法 在两个或多个类之间创建一种 “是一个” 的关系 Python 支持多继承，Java 和 C# 只能继承一个类\n覆盖（override） 如果从父类继承的方法不能满足子类的需求，可以对其进行改写，这个过程叫方法的覆盖，也称为方法的重写。在子类定义父类同名方法之后，父类方法就被覆盖了\n1 2 3 super().__init__(...) # Python 3 super(子类, self).__init__(...) # Python 新式类和经典类 经典类和新式类的的区别：\n继承搜索顺序：新式类的 MRO(基类搜索顺序)算法采用 C3 广度优先算法，经典类采用深度优先 类和类型合并：新式类统一了类（class）和类型（type） 新的高级工具：新式类有更多的高级工具，如 slot、特性、描述符等 新式类是在创建的时候继承内置 object 对象，为了确保使用的是新式类，有以下方法：\n放在类模块代码的最前面 metaclass = type 从内建类 object 直接或者间接地继承 在 Python3 版本中，默认所有的类都是新式类 多继承 MRO (method resolution order)\n按深度优先，从左到右顺序获取列表 移除列表中的重复类型，仅保留最后一个 确保子类总是在基类前，并保留多继承定义顺序 最佳实践：\n避免使用多继承 调用父类时查看类的层次结构，使用 mro 方法 举例：\n1 2 3 4 5 6 7 8 9 10 11 12 In : class A:pass In : class B:pass In : class C(A):pass In : class D(B):pass In : class E(C, D):pass In : E.__mro__ Out: (__main__.E, __main__.C, __main__.A, __main__.D, __main__.B, object) 多继承中的 super 方法\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 class A(object): def go(self): print(\"go A go!\") class B(A): def go(self): super(B, self).go() print(\"go B go!\") class C(A): def go(self): super(C, self).go() print(\"go C go!\") class D(B,C): def go(self): super(D, self).go() print(\"go D go!\") class E(B,C): pass a = A() b = B() c = C() d = D() e = E() # 以下都输出什么 a.go() b.go() c.go() d.go() e.go() In : a.go() go A go! In : b.go() go A go! go B go! In : c.go() go A go! go C go! In : d.go() go A go! go C go! go B go! go D go! In : e.go() go A go! go C go! go B go! In : E.__mro__ Out: (__main__.E, __main__.B, __main__.C, __main__.A, object) In : D.__mro__ Out: (__main__.D, __main__.B, __main__.C, __main__.A, object) 组合与继承 类存在两种关系，组合和继承。一般来说，优先使用组合而非继承\n组合是使用其他的类实例作为自己的一个属性（has a 关系）；继承是子类继承父类的属性和方法（is a 关系） 功能扩展使用继承；使用某些功能使用组合 组合仅依赖对方的外部接口，没有任何实现上的关联，很容易替换 过多的继承增加了代码的复杂程度 封装 封装(Encapsulation)即对外部隐藏有关对象工作原理的细节。封装其实就是使用构造方法将内容封装到对象中，然后通过对象直接或者 self 间接获取被封装的内容\n多态 多态(polymorphism)。也就是同一个方法，不同的行为，指由继承而产生的相关但不同的类，其对象对同一消息会做出不同的响应\n元类 type、object 和 class Python 里要查看一个 type 的父类，使用 __bases__ 属性可以查看；查看一个 Instance 的 type，使用 __class__ 属性可以查看，或者使用 type() 函数\n1 2 3 4 5 6 7 8 9 10 11 In: class Foo:pass In: class Bar(Foo):pass In: b = Bar() In : Bar.__bases__, Bar.__class__ Out: ((__main__.Foo,), type) In : b.__class__, type(b) Out: (__main__.Bar, __main__.Bar) 每个 Python 类的定义都会隐式的继承 object 类，但不会包括任何行为\n1 2 3 4 5 6 7 In: class X: pass In: print(X.__class__) # 类的定义就是对 type 类的一个对象的类型声明 \u003cclass 'type'\u003e In: print(X.__class__.__base__) # 继承自 object 基类 \u003cclass 'object'\u003e Python 中 object 和 type 是共生的关系，必须同时出现的。object 是父子关系的顶端，所有的类型的父类都是它。type 是类型实例关系的顶端，所有对象都是它的实例，即一切对象均由 type 实例化出来，一切对象都继承 object\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 In : type(type) Out: type In : print(object, type) \u003cclass 'object'\u003e ","wordCount":"1323","inLanguage":"en","datePublished":"2021-10-01T15:40:18Z","dateModified":"2021-10-01T15:40:18Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://120.79.76.172:8381/post/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"},"publisher":{"@type":"Organization","name":"haoyu blog","logo":{"@type":"ImageObject","url":"http://120.79.76.172:8381/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://120.79.76.172:8381 accesskey=h title="haoyu blog (Alt + H)"><img src=http://120.79.76.172:8381/apple-touch-icon.png alt aria-label=logo height=35>haoyu blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://120.79.76.172:8381/archives/ title=时间轴><span>时间轴</span></a></li><li><a href=http://120.79.76.172:8381/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://120.79.76.172:8381>Home</a>&nbsp;»&nbsp;<a href=http://120.79.76.172:8381/post/>Posts</a></div><h1 class=post-title>python面向对象</h1><div class=post-meta><span title='2021-10-01 15:40:18 +0000 UTC'>October 1, 2021</span>&nbsp;·&nbsp;1323 words</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#面向对象-1>面向对象</a><ul><li><a href=#面向对象-2>面向对象</a></li><li><a href=#类与对象>类与对象</a></li><li><a href=#一等对象>一等对象</a></li></ul></li><li><a href=#对象成员>对象成员</a><ul><li><a href=#属性>属性</a></li><li><a href=#方法>方法</a></li><li><a href=#私有字段>私有字段</a></li><li><a href=#property>property</a></li></ul></li><li><a href=#三大特征>三大特征</a><ul><li><a href=#继承>继承</a></li><li><a href=#封装>封装</a></li><li><a href=#多态>多态</a></li></ul></li><li><a href=#元类>元类</a><ul><li><a href=#typeobject-和-class>type、object 和 class</a></li><li><a href=#元类-1>元类</a></li></ul></li><li><a href=#应用>应用</a><ul><li><a href=#self>self</a></li><li><a href=#鸭子类型>鸭子类型</a></li><li><a href=#自省>自省</a></li><li><a href=#猴子补丁>猴子补丁</a></li><li><a href=#单例>单例</a></li></ul></li><li><a href=#相关阅读>相关阅读</a></li></ul></nav></div></details></div><div class=post-content><h1 id=面向对象>面向对象<a hidden class=anchor aria-hidden=true href=#面向对象>#</a></h1><p>本文主要说明面向对象在 python 中的实现，有关面向对象的知识详见 <a href=:/fd24a3fa70e64b25834c3abfa978ffb2>06-面向对象</a></p><p>[TOC]</p><h2 id=面向对象-1>面向对象<a hidden class=anchor aria-hidden=true href=#面向对象-1>#</a></h2><blockquote><p>In python everything is an object. objects are first class citizens</p></blockquote><h3 id=面向对象-2>面向对象<a hidden class=anchor aria-hidden=true href=#面向对象-2>#</a></h3><p>对象：</p><ul><li>对象是一个数据以及相关行为的集合，对象是一个模型，模型可以做特定的事情并且特定的事情可以作用在它们身上</li><li>python 对象是存储在内存中的实体，通常是一段具有特定格式的内存。每个对象都有两个标准的头部信息，类型标识符和引用计数器</li></ul><p>面向对象</p><ul><li>通过数据和行为来描述和与对象交互<ul><li>数据：代表一个给定对象的个体特征</li><li>行为：发生再对象身上的动作</li></ul></li><li>有三个基本特征：<strong>封装</strong>，<strong>继承</strong>，<strong>多态</strong></li></ul><p><code>Python</code> 既支持面向对象编程也支持函数式编程。在 <code>Python</code> 中，所有事物都是 <code>object</code>，包括数值、列表、函数、None、模块等等</p><h3 id=类与对象>类与对象<a hidden class=anchor aria-hidden=true href=#类与对象>#</a></h3><blockquote><p>Class is a blueprint or template from which objects are created.
类描述了对象，是创建对象的模版</p></blockquote><p><strong>类</strong> (<code>Class</code>)定义了事物的抽象特点，有共有的属性和方法。类就是一个模板，模板里可以包含多个函数，函数里实现一些功能。类本质仍然是一个对象，可以赋值给变量，可拷贝，可作为函数参数传递</p><p><strong>对象</strong> 是类的实例 (<code>Instance</code>)。类可生成多个实例，可被继承和扩展，支持运算符，可按需重载</p><p>当 <code>Python</code> 遇到关键字 <code>class</code> 时，就在内存中开辟一块空间，类中的方法也存储在开辟的空间内。当以这个类创建实例时，就在内存中开辟另一块空间，通过<strong>类对象指针</strong>指向类的空间</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=n>f</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>()</span>    <span class=c1># 创建 Foo 的实例</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>Foo</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>__main__</span><span class=o>.</span><span class=n>Foo</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>__main__</span><span class=o>.</span><span class=n>Foo</span> <span class=nb>object</span> <span class=n>at</span> <span class=mh>0x109db6fd0</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=一等对象>一等对象<a hidden class=anchor aria-hidden=true href=#一等对象>#</a></h3><p>所有可以在语言中命名的对象都具有同等的状态。都作为<strong>一等对象</strong> (<code>First Class Citizens</code>) 存在。一等对象有以下特点：</p><ul><li>在运行时创建</li><li>能赋值给变量或数据结构中的元素</li><li>能作为参数传给函数</li><li>能作为函数的返回结果</li></ul><h2 id=对象成员>对象成员<a hidden class=anchor aria-hidden=true href=#对象成员>#</a></h2><h3 id=属性>属性<a hidden class=anchor aria-hidden=true href=#属性>#</a></h3><p><strong>属性</strong> (<code>attribute</code>)：对象可以使用属于它的变量来存储数据，这种从属于对象或类的变量就是属性，它描述了对象的特征</p><ul><li><strong>实例变量</strong>：保存在实例中，不同实例之间不影响，只能通过实例访问</li><li><strong>类变量</strong>：保存在类中，多有实例共享，可以通过实例访问，也可以通过类访问。当需要在一个类的不同实例之间共享变量的时可以用类变量</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>...</span><span class=p>:</span>     <span class=n>a</span> <span class=o>=</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl><span class=o>...</span><span class=p>:</span>     <span class=n>b</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=p>,</span> <span class=n>f2</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>(),</span> <span class=n>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>f2</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>Foo</span><span class=o>.</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=mi>123</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>f2</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>Foo</span><span class=o>.</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>f2</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>Foo</span><span class=o>.</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>b</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=n>b</span><span class=p>,</span> <span class=n>f2</span><span class=o>.</span><span class=n>b</span><span class=p>,</span> <span class=n>Foo</span><span class=o>.</span><span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>([</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=o>.</span><span class=vm>__dict__</span>    <span class=c1># 类型的名字空间返回只读视图，不允许修改</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>mappingproxy</span><span class=p>({</span><span class=s1>&#39;__module__&#39;</span><span class=p>:</span> <span class=s1>&#39;__main__&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=mi>123</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=o>...</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f1</span><span class=o>.</span><span class=vm>__dict__</span>    <span class=c1># 实例的名字空间是普通字典，可修改</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=方法>方法<a hidden class=anchor aria-hidden=true href=#方法>#</a></h3><p><strong>方法</strong>(method)：类中的函数，能通过它对对象做操作</p><ul><li><strong>实例方法</strong>由实例调用，自动把调用该方法的实例赋值给 <code>self</code></li><li><strong>静态方法</strong>由类或实例调用，无默认参数，使用 <code>@staticmethod</code> 装饰器实现</li><li><strong>类方法</strong>由类或实例调用，第一个参数是类本身，约定 <code>cls，使用</code> <code>@classmethod</code> 装饰器实现</li></ul><p>静态方法和类方法都访问不到实例变量，因为没有 <code>self</code>。实例方法影响的只是实例的变量，影响不到类变量，而类方法当作实例方法会影响实例变量和类变量</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>instance_method</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;我是实例方法&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>static_method</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;我是静态方法&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>class_method</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;我是类方法&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=私有字段>私有字段<a hidden class=anchor aria-hidden=true href=#私有字段>#</a></h3><ul><li><code>__xxx__</code>: <code>Python</code> 语言定义的特殊方法，用来区别其他用户自定义的命名，如 <code>__init__()</code></li><li><code>_xxx</code>: 用来指定变量私有，用做提示，对程序没有任何影响</li><li><code>__xxx</code>: 在类中会触发名称改写，只能通过 <code>对象名._类名__xxx</code> 的方式访问</li><li><code>xxx_</code>: 用以避免与 Python 关键字冲突</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>_xxx</span> <span class=o>=</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__xx</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=n>f</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>(</span><span class=s1>&#39;haoyu&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>_xxx</span>
</span></span><span class=line><span class=cl><span class=n>Ou</span><span class=p>:</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>__xx</span>
</span></span><span class=line><span class=cl><span class=ne>AttributeError</span><span class=p>:</span> <span class=s1>&#39;Foo&#39;</span> <span class=nb>object</span> <span class=n>has</span> <span class=n>no</span> <span class=n>attribute</span> <span class=s1>&#39;__xx&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>_Foo__xx</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=s1>&#39;haoyu&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=vm>__dict__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;_Foo__xx&#39;</span><span class=p>:</span> <span class=s1>&#39;haoyu&#39;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=property>property<a hidden class=anchor aria-hidden=true href=#property>#</a></h3><p><code>@property</code> 装饰器就是负责把一个方法变成属性调用，方法内部进行一系列的逻辑计算，最终返回结果。定义时，在普通方法的基础上添加 <code>@property</code> 装饰器，属性仅有一个 <code>self</code> 参数，调用时，无需括号</p><p>可以通过设置 <code>get</code> 方法而不定义 <code>set</code> 方法就可以实现变量的只读属性</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>attr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@attr</span><span class=o>.</span><span class=n>setter</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>attr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>val</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@attr</span><span class=o>.</span><span class=n>deleter</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>attr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=mi>666</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>attr</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>attr</span> <span class=o>=</span> <span class=mi>456</span>
</span></span><span class=line><span class=cl><span class=mi>456</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>del</span> <span class=n>f</span><span class=o>.</span><span class=n>attr</span>
</span></span><span class=line><span class=cl><span class=mi>666</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=三大特征>三大特征<a hidden class=anchor aria-hidden=true href=#三大特征>#</a></h2><h3 id=继承>继承<a hidden class=anchor aria-hidden=true href=#继承>#</a></h3><p><strong>继承</strong>：</p><ul><li>子类可以继承父类通用类型的属性和方法。也就是在父类或者说基类里面实现一次就能被子类重用</li><li>对于面向对象的继承来说，其实就是将多个类共有的方法提取到父类中，子类仅需继承父类而不必一一实现每个方法</li><li>在两个或多个类之间创建一种 &ldquo;是一个&rdquo; 的关系</li></ul><p><code>Python</code> 支持多继承，<code>Java</code> 和 <code>C#</code> 只能继承一个类</p><h4 id=覆盖override>覆盖（override）<a hidden class=anchor aria-hidden=true href=#覆盖override>#</a></h4><p>如果从父类继承的方法不能满足子类的需求，可以对其进行改写，这个过程叫方法的覆盖，也称为方法的重写。在子类定义父类同名方法之后，父类方法就被覆盖了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>    <span class=c1># Python 3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>super</span><span class=p>(</span><span class=n>子类</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>    <span class=c1># Python </span>
</span></span></code></pre></td></tr></table></div></div><h4 id=新式类和经典类>新式类和经典类<a hidden class=anchor aria-hidden=true href=#新式类和经典类>#</a></h4><p>经典类和新式类的的区别：</p><ul><li>继承搜索顺序：新式类的 <code>MRO</code>(基类搜索顺序)算法采用 <code>C3</code> 广度优先算法，经典类采用深度优先</li><li>类和类型合并：新式类统一了类（<code>class</code>）和类型（<code>type</code>）</li><li>新的高级工具：新式类有更多的高级工具，如 <code>slot</code>、特性、描述符等</li></ul><p>新式类是在创建的时候继承内置 <code>object</code> 对象，为了确保使用的是新式类，有以下方法：</p><ul><li>放在类模块代码的最前面 <code>metaclass = type</code></li><li>从内建类 <code>object</code> 直接或者间接地继承</li><li>在 <code>Python3</code> 版本中，默认所有的类都是新式类</li></ul><h4 id=多继承>多继承<a hidden class=anchor aria-hidden=true href=#多继承>#</a></h4><p><code>MRO</code> (method resolution order)</p><ul><li>按深度优先，从左到右顺序获取列表</li><li>移除列表中的重复类型，仅保留最后一个</li><li>确保子类总是在基类前，并保留多继承定义顺序</li></ul><p>最佳实践：</p><ul><li>避免使用多继承</li><li>调用父类时查看类的层次结构，使用 <strong>mro</strong> 方法</li></ul><p>举例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>A</span><span class=p>:</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>B</span><span class=p>:</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>C</span><span class=p>(</span><span class=n>A</span><span class=p>):</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>D</span><span class=p>(</span><span class=n>B</span><span class=p>):</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>E</span><span class=p>(</span><span class=n>C</span><span class=p>,</span> <span class=n>D</span><span class=p>):</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>E</span><span class=o>.</span><span class=vm>__mro__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=n>__main__</span><span class=o>.</span><span class=n>E</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>C</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>A</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>D</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>B</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>多继承中的 super 方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>go</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;go A go!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span><span class=p>(</span><span class=n>A</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>go</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>B</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;go B go!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span><span class=p>(</span><span class=n>A</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>go</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>C</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;go C go!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>D</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>C</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>go</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>D</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;go D go!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>E</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>C</span><span class=p>):</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>A</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>B</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>C</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>D</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=n>E</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 以下都输出什么</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>b</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>d</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>e</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>a</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>A</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>b</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>A</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>B</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>A</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>C</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>A</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>C</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>B</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>D</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>e</span><span class=o>.</span><span class=n>go</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>A</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>C</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=n>go</span> <span class=n>B</span> <span class=n>go</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>E</span><span class=o>.</span><span class=vm>__mro__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=n>__main__</span><span class=o>.</span><span class=n>E</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>B</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>C</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>A</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>D</span><span class=o>.</span><span class=vm>__mro__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=n>__main__</span><span class=o>.</span><span class=n>D</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>B</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>C</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>A</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=组合与继承>组合与继承<a hidden class=anchor aria-hidden=true href=#组合与继承>#</a></h4><p>类存在两种关系，组合和继承。一般来说，优先使用组合而非继承</p><ul><li>组合是使用其他的类实例作为自己的一个属性（<code>has a</code> 关系）；继承是子类继承父类的属性和方法（<code>is a</code> 关系）</li><li>功能扩展使用继承；使用某些功能使用组合</li><li>组合仅依赖对方的外部接口，没有任何实现上的关联，很容易替换</li><li>过多的继承增加了代码的复杂程度</li></ul><h3 id=封装>封装<a hidden class=anchor aria-hidden=true href=#封装>#</a></h3><p><strong>封装</strong>(<code>Encapsulation</code>)即对外部隐藏有关对象工作原理的细节。封装其实就是使用构造方法将内容封装到对象中，然后通过对象直接或者 <code>self</code> 间接获取被封装的内容</p><h3 id=多态>多态<a hidden class=anchor aria-hidden=true href=#多态>#</a></h3><p><strong>多态</strong>(<code>polymorphism</code>)。也就是同一个方法，不同的行为，指由继承而产生的相关但不同的类，其对象对同一消息会做出不同的响应</p><h2 id=元类>元类<a hidden class=anchor aria-hidden=true href=#元类>#</a></h2><h3 id=typeobject-和-class>type、object 和 class<a hidden class=anchor aria-hidden=true href=#typeobject-和-class>#</a></h3><p><code>Python</code> 里要查看一个 <code>type</code> 的父类，使用 <code>__bases__</code> 属性可以查看；查看一个 <code>Instance</code> 的 <code>type</code>，使用 <code>__class__</code> 属性可以查看，或者使用 <code>type()</code> 函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=k>class</span> <span class=nc>Bar</span><span class=p>(</span><span class=n>Foo</span><span class=p>):</span><span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=n>b</span> <span class=o>=</span> <span class=n>Bar</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Bar</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>,</span> <span class=n>Bar</span><span class=o>.</span><span class=vm>__class__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>((</span><span class=n>__main__</span><span class=o>.</span><span class=n>Foo</span><span class=p>,),</span> <span class=nb>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>b</span><span class=o>.</span><span class=vm>__class__</span><span class=p>,</span> <span class=nb>type</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=n>__main__</span><span class=o>.</span><span class=n>Bar</span><span class=p>,</span> <span class=n>__main__</span><span class=o>.</span><span class=n>Bar</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>每个 <code>Python</code> 类的定义都会隐式的继承 <code>object</code> 类，但不会包括任何行为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=k>class</span> <span class=nc>X</span><span class=p>:</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=vm>__class__</span><span class=p>)</span>    <span class=c1># 类的定义就是对 type 类的一个对象的类型声明</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>type</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__base__</span><span class=p>)</span>    <span class=c1># 继承自 object 基类</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>object</span><span class=s1>&#39;&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Python</code> 中 <code>object</code> 和 <code>type</code> 是共生的关系，必须同时出现的。<code>object</code> 是父子关系的顶端，所有的类型的父类都是它。<code>type</code> 是类型实例关系的顶端，所有对象都是它的实例，即一切对象均由 <code>type</code> 实例化出来，一切对象都继承 <code>object</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>type</span><span class=p>(</span><span class=nb>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=nb>type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=nb>object</span><span class=p>,</span> <span class=nb>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>object</span><span class=s1>&#39;&gt; &lt;class &#39;</span><span class=nb>type</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>object</span><span class=o>.</span><span class=vm>__class__</span>    <span class=c1># object 是 type 的一个实例</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=nb>type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>object</span><span class=o>.</span><span class=vm>__bases__</span>    <span class=c1># object 无父类，因为它是链条顶端</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>type</span><span class=o>.</span><span class=vm>__bases__</span>    <span class=c1># type 的父类是 object</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=nb>object</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>type</span><span class=o>.</span><span class=vm>__class__</span>    <span class=c1># type 的类型是自己</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=nb>type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># list, dict 等内置数据类型父类都是 object，类型都是 type</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span>  <span class=nb>list</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>,</span> <span class=nb>dict</span><span class=o>.</span><span class=vm>__bases__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>((</span><span class=nb>object</span><span class=p>,),</span> <span class=p>(</span><span class=nb>object</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span>  <span class=nb>list</span><span class=o>.</span><span class=vm>__class__</span><span class=p>,</span> <span class=nb>dict</span><span class=o>.</span><span class=vm>__class__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=nb>type</span><span class=p>,</span> <span class=nb>type</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>isinstance(object, classinfo)</code> 判定 <code>object</code> 是 <code>classinfo</code> 的实例；使用 <code>issubclass(class, classinfo)</code> 判定 <code>class</code> 是否是 <code>classinfo</code> 的子类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=nb>int</span><span class=p>),</span> <span class=nb>isinstance</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span><span class=nb>type</span><span class=p>),</span> <span class=nb>isinstance</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span><span class=nb>type</span><span class=p>),</span> <span class=nb>isinstance</span><span class=p>(</span><span class=nb>object</span><span class=p>,</span><span class=nb>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=nb>issubclass</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span><span class=nb>object</span><span class=p>),</span> <span class=nb>issubclass</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span><span class=nb>object</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=元类-1>元类<a hidden class=anchor aria-hidden=true href=#元类-1>#</a></h3><p>元类（<code>Meta Class</code>）是创建类的类，元类创建类，类创建实例。元类可以控制类的生成，比如修改类的属性。最常用的使用场景就是 <code>ORM</code> 框架</p><p><code>type</code> 可以接受一个类的描述作为参数，然后返回一个类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>X</span><span class=p>:</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>X</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nb>object</span><span class=p>,),</span> <span class=nb>dict</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span>    <span class=c1># 同上</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>DemoMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span><span class=k>pass</span>    <span class=c1># 自定义元类，继承 type，以 Meta 结尾</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=k>class</span> <span class=nc>X</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>DemoMeta</span><span class=p>):</span><span class=k>pass</span>    <span class=c1># 使用自定义元类</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>X</span><span class=o>.</span><span class=vm>__class__</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=n>__main__</span><span class=o>.</span><span class=n>DemoMeta</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=应用>应用<a hidden class=anchor aria-hidden=true href=#应用>#</a></h2><h3 id=self>self<a hidden class=anchor aria-hidden=true href=#self>#</a></h3><p>类所创建的多个实例之间，除家族归属外，并无直接关系。隐式参数 <code>self</code> 总是指向当前调用实例，与继承层次无关，传入 <code>self</code> 参数就是传入创建的对象名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>__main__</span><span class=o>.</span><span class=n>Foo</span> <span class=nb>object</span> <span class=n>at</span> <span class=mh>0x10c2d3668</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>f</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=o>&lt;</span><span class=n>__main__</span><span class=o>.</span><span class=n>Foo</span> <span class=n>at</span> <span class=mh>0x10c2d3668</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=鸭子类型>鸭子类型<a hidden class=anchor aria-hidden=true href=#鸭子类型>#</a></h3><blockquote><p>当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子</p></blockquote><ul><li>关注点在对象的行为，而不是类型 (<code>duck typing</code>)</li><li>比如 <code>file、StringIO、socket</code> 对象都支持 <code>read/write</code> 方法 (file like object)</li><li>定义了 <code>__iter__</code> 魔法方法的对象可以用 <code>for</code> 迭代</li></ul><p>比如 <code>list.extend()</code> 方法中，并不关心参数是不是 <code>list</code>，只要它是可迭代的，可以是 <code>list、tuple、dict、字符串、生成器</code>等</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bird</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>quack</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;i am bird, duck, duck, duck&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Doge</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>quack</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;i am dogo, duck, duck, duck&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>in_the_forest</span><span class=p>(</span><span class=n>duck</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>duck</span><span class=o>.</span><span class=n>quack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bird</span> <span class=o>=</span> <span class=n>Bird</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>doge</span> <span class=o>=</span> <span class=n>Doge</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=p>[</span><span class=n>bird</span><span class=p>,</span> <span class=n>doge</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>in_the_forest</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=n>am</span> <span class=n>bird</span><span class=p>,</span> <span class=n>duck</span><span class=p>,</span> <span class=n>duck</span><span class=p>,</span> <span class=n>duck</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=n>am</span> <span class=n>dogo</span><span class=p>,</span> <span class=n>duck</span><span class=p>,</span> <span class=n>duck</span><span class=p>,</span> <span class=n>duck</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=自省>自省<a hidden class=anchor aria-hidden=true href=#自省>#</a></h3><ul><li>运行时判断一个对象的类型</li><li><code>Python</code> 一切皆对象，用 <code>type、id、isinstance、dir</code> 获取对象类型信息</li><li><code>Inspect</code> 模块提供了更多获取对象信息的函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Foo</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>a</span> <span class=o>**</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>a</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=p>(</span><span class=s1>&#39;haoyu&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>:</span> <span class=s1>&#39;HAOYU&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=猴子补丁>猴子补丁<a hidden class=anchor aria-hidden=true href=#猴子补丁>#</a></h3><p>猴子补丁仅指在运行时对类或模块的动态修改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 在类 Foo 之外定义的方法 monkey_f， 并对类的行为进行了一些更改</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;i am f&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>monkey_f</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;i am monkey_f&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=o>.</span><span class=n>f</span> <span class=o>=</span> <span class=n>monkey_f</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>:</span> <span class=n>Foo</span><span class=p>()</span><span class=o>.</span><span class=n>f</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=n>am</span> <span class=n>monkey_f</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=单例>单例<a hidden class=anchor aria-hidden=true href=#单例>#</a></h3><p>单例模式（<code>Singleton Pattern</code>）是一种常用的软件设计模式，该模式的主要目的是确保某一个类只有一个实例存在。Python 中有多种方法来实现单例</p><ul><li>使用模块。模块在第一次导入时，会生成 .pyc 文件，当第二次导入时，直接加载 .pyc 文件</li><li>使用 <code>__new__</code> 控制实例的创建过程</li><li>使用装饰器</li><li>使用元类</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 使用 new 实现，将类实例和一个类变量 _instance 关联起来</span>
</span></span><span class=line><span class=cl><span class=c1># 如果 cls._instance 为 None 则创建实例。否则直接返回 cls._instance</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=s1>&#39;_instance&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>orig</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Singleton</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span> <span class=o>=</span> <span class=n>orig</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 装饰器实现。判断某个类是否在字典 instances 中，不存在则创建，存在则返回</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>singleton</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>instances</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>getinstance</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>cls</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>instances</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>getinstance</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=相关阅读>相关阅读<a hidden class=anchor aria-hidden=true href=#相关阅读>#</a></h2><ul><li><a href=http://zetcode.com/lang/python/oop/>Object-oriented programming in Python</a></li><li><a href=https://docs.python.org/3/tutorial/classes.html>Classes</a></li><li><a href=http://www.cnblogs.com/wupeiqi/articles/5017742.html>面向对象文本</a></li><li><a href=https://www.zhihu.com/question/38791962>Python 的 type 和 object 之间是怎么一种关系</a></li><li><a href=https://stackoverflow.com/questions/100003/what-are-metaclasses-in-python>What are metaclasses in Python?</a></li><li><a href=https://blog.ionelmc.ro/2015/02/09/understanding-python-metaclasses/>Understanding Python metaclasses</a></li><li><a href=http://funhacks.net/2017/01/17/singleton/>Python 中的单例模式</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://120.79.76.172:8381/tags/python/>python</a></li></ul><nav class=paginav><a class=prev href=http://120.79.76.172:8381/post/python%E5%AD%97%E5%85%B8%E4%B8%8E%E9%9B%86%E5%90%88/><span class=title>« Prev</span><br><span>python字典与集合</span></a>
<a class=next href=http://120.79.76.172:8381/post/redis%E5%9F%BA%E7%A1%80/><span class=title>Next »</span><br><span>redis基础</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=http://120.79.76.172:8381>haoyu blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>